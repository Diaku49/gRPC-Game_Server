syntax = "proto3";

package game;

option go_package = "/pb";

import "game.proto";

// the whole game server and its functionality
service GameServer {
    //-------------- Lobby
    // Listing game rooms
    rpc GetGameRooms(GetGameRoomsReq) returns (GetGameRoomsRes);
    // Create game room
    rpc CreateGameRoom(CreateGameRoomReq) returns (Message);
    // Close game room
    rpc CloseGameRoom(CloseGameRoomReq) returns (Message);
    // Signup api
    rpc SignUpUser(SignUpUserReq) returns (Message);
    // Login api
    rpc LoginUser(LoginUserReq) returns (LoginUserRes);
    //-------------- Game
    // Join game
    rpc JoinGame(JoinGameReq) returns (JoinGameRes);
    // Starting game
    rpc StartGame(StartGameReq) returns (stream StartGameRes);
    // Make move
    rpc MakeMove(MakeMoveReq) returns (MakeMoveRes);
}

//------------ Lobby --------------
// Signup User
message SignUpUserReq {
   string name = 1;
   string email = 2;
   string password = 3;
};

// Login User
message LoginUserReq {
    string email = 1;
    string password = 2;
}

message LoginUserRes {
    string id = 1;
    string name = 2;
    int32 total_win = 3;
    int32 total_games = 4;
    string token = 5;
}

message GetGameRoomsReq {
    int32 page = 1;
    int32 size = 2;
}
message GetGameRoomsRes {
    repeated GameRooms game_rooms = 1;
}

message GameRooms {
    string id = 1;
    string status = 2;
    int32 rounds_num = 3;
    string player1_name = 4;
    string player2_name = 5;
}

//----------- Game -----------
// Create game
message CreateGameRoomReq {
    string user_id = 1;
}
// Close game
message CloseGameRoomReq {
    string game_id =1;
}

//------------- Gameplay ------------

// Join
message JoinGameReq {
    string player_id = 1;
    string player_name = 2;
    int32 total_win = 3;
    int32 total_games = 4;
    string room_id = 5;
}
message JoinGameRes {
   string game_id = 1;
   string message = 2;
}

// Start Game
message StartGameReq {
   string player_id = 1;
}
message StartGameRes {
    GameRoom game_info = 1;
}

// Make Move
message MakeMoveReq {
    string player_id = 1;
    Directions direction = 2;
}

message MakeMoveRes {}

//----------- Common ----------------
message Message {
    string id = 1;
    string message = 2;
}

//--------------- Enum -----------------
enum Directions {
    UP = 0;
    DOWN = 1;
    RIGHT = 2;
    LEFT = 3;
}

//------------- Cleanup ----------------